<!doctype html>
<head>
	<meta charset="utf-8">

	<link type="text/css" rel="stylesheet" href="../rickshaw.css">

	<script src="../vendor/d3.v3.js"></script>
	<script src="../rickshaw.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/redux/3.7.2/redux.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.6.1/react.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.6.1/react-dom.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/react-redux/5.0.5/react-redux.js"></script>

	<style>
	.column { display: inline-block }
	.legend { background: white }
	.legend .line { color: #333 }

	div, span, p, td {
		font-family: Arial, sans-serif;
	}
	.chart {
		display: inline-block;
	}
	.slider {
		position: relative;
	}
	.legend {
		display: inline-block;
		position: relative;
		left: 8px;
	}
	.legend_container {
		position: absolute;
		right: 0;
		bottom: 26px;
		width: 0;
	}
	.chart_container {
		float: left;
		position: relative;
	}

	</style>
</head>

<body>

<div class="header">
	<h3 class="text-muted">React Redux Example</h3>
	<ul>
		<li>https://medium.com/@pbesh/linked-highlighting-with-react-d3-js-and-reflux-16e9c0b2210b</li>
		<li>https://medium.com/@ilikepiecharts/about-using-d3-react-squared-an-example-8cc5e5a6b58e</li>
		<li>https://oli.me.uk/2015/09/09/d3-within-react-the-right-way/</li>
		<li>https://react.rocks/tag/Chart</li>
		<li>https://github.com/react-d3/react-d3-core/blob/aca623fae9fd01aa4c7217c640b6de3995f369b5/react-d3-core.js#L5895</li>
		<li>https://blog.serverdensity.com/time-series-charts-react-redux-d3/</li>
		<li>http://software.es.net/react-timeseries-charts/#/?_k=l60al6</li>
	</ul>
</div>

<div id="app">
</div>

<script>
// deep cloning function excerpted from underscore.js
function deepClone (obj) {
	if(obj == null || typeof(obj) != 'object') {
		return obj;
	}
	const temp = new obj.constructor();
	for(let key in obj) {
		if (obj.hasOwnProperty(key)) {
			temp[key] = deepClone(obj[key]);
		}
	}
	return temp;
};
</script>

<script>
const seriesData = [ [], [], [], [], [] ];
const random = new Rickshaw.Fixtures.RandomData(50);

for (var i = 0; i < 75; i++) {
	random.addData(seriesData);
}

const initialstate = {
	renderer: 'multi',
	width: 900,
	height: 500,
	dotSize: 5,
	series: [{
		name: 'temperature',
		data: seriesData.shift(),
		color: 'rgba(255, 0, 0, 0.4)',
		renderer: 'stack'
	}, {
		name: 'heat index',
		data: seriesData.shift(),
		color: 'rgba(255, 127, 0, 0.4)',
		renderer: 'stack'
	}, {
		name: 'dewpoint',
		data: seriesData.shift(),
		color: 'rgba(127, 0, 0, 0.3)',
		renderer: 'scatterplot'
	}, {
		name: 'pop',
		data: seriesData.shift().map(function(d) {
			return {
				x: d.x,
				y: d.y / 4
			}
		}),
		color: 'rgba(0, 0, 127, 0.4)',
		renderer: 'bar'
	}, {
		name: 'humidity',
		data: seriesData.shift().map(function(d) {
			return {
				x: d.x,
				y: d.y * 1.5
			}
		}),
		renderer: 'line',
		color: 'rgba(0, 0, 127, 0.25)'
	}]
};

function graphReducer(_state = initialstate, action = null) {
	let state = deepClone(_state);
	switch (action.type) {
	case 'DATA_CHANGED':
		return state;
	case 'RESET':
		return initialstate;
	default:
		return _state;
	}
}

const store = Redux.createStore(graphReducer);
initialstate.element =  document.createElement('div');
var graph = new Rickshaw.Graph(initialstate);
const Provider = ReactRedux.Provider;

class App extends React.Component {
	render() {
		return React.createElement('div', {}, [
			React.createElement('div', {
				className: "column",
				key: 'row1'
			}, [
				React.createElement(Graph, {
					key: 'chart',
					id: 'chart'
				}),
				React.createElement(Slider, {
					key: 'slider'
				})
			]),
			React.createElement(Legend, {
				className: "column legend",
				key: 'row2'
			}),
		]);
	}
}
</script>

<script>
class Slider extends React.Component {
	render() {
		var slider = new Rickshaw.Graph.RangeSlider.Preview({
			graph: graph,
			element: document.createElement('div')
		});

		return React.createElement('div', {
			className: 'slider',
			dangerouslySetInnerHTML: {
				__html: slider.element.innerHTML
			}
		});
	}
}
</script>

<script>
class Graph extends React.Component {
	render() {

		var detail = new Rickshaw.Graph.HoverDetail({
			graph: graph
		});

		graph.render();

		return React.createElement('div', {
			className: 'rickshaw_graph chart',
			dangerouslySetInnerHTML: {
				__html: graph.element.innerHTML
			}
		});
	}
}
</script>

<script>
class Legend extends React.Component {
	render() {
		var legend = new Rickshaw.Graph.Legend({
			graph: graph,
			element: document.createElement('div')
		});

		var highlighter = new Rickshaw.Graph.Behavior.Series.Highlight({
			graph: graph,
			legend: legend,
			disabledColor: function() {
				return 'rgba(0, 0, 0, 0.2)'
			}
		});

		var highlighter = new Rickshaw.Graph.Behavior.Series.Toggle({
			graph: graph,
			legend: legend
		});

		return React.createElement('div', {
			className: 'column rickshaw_legend legend',
			dangerouslySetInnerHTML: {
				__html: legend.element.innerHTML
			}
		});
	}
}
</script>

<script>
ReactDOM.render(
	React.createElement(App, {
		graph: 'Placeholder'
	}, null),
	document.getElementById('app')
);
</script>

</body>
</html>
